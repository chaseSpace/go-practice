## PgSQL 介绍

### PostgreSQL vs MySQL 核心特性深度对比

| 维度          | PostgreSQL (功能最强大的开源库)                                    | MySQL (最流行的 Web 数据库)                            |
|-------------|-----------------------------------------------------------|-------------------------------------------------|
| 数据库类型       | ORDBMS (对象-关系型)：支持继承、函数重载等面向对象特性。                         | RDBMS (关系型)：纯关系模型，专注于标准化的表结构。                   |
| SQL 标准兼容性   | 极高：几乎完全遵循 ANSI SQL 标准，语法严谨。                               | 一般：存在较多方言，部分标准功能实现较简略。                          |
| 并发控制 (MVCC) | 无锁读取：写操作不阻塞读，多进程架构在复杂事务下更稳定。                              | 基于 Undo Log：在高并发简单查询下性能极佳，依靠多线程减少开销。            |
| 连接模型        | 多进程架构：每个连接对应一个独立进程，内存隔离性好，单进程崩溃不影响其他连接，但内存开销较大。           | 多线程架构：多个连接共享同一进程内存空间，线程间通信高效，内存利用率高，但需注意线程安全问题。 |
| 数据类型支持      | 极其丰富：原生支持 JSONB、数组、几何/地理、UUID、网络地址、范围类型等。                 | 基础：支持标准类型及 JSON，复杂类型多依赖字符串或 JSON 模拟。            |
| 索引能力        | 多样化：支持 B-Tree, GIN (搜索 JSON/数组), GiST, BRIN, 表达式索引, 部分索引。 | 较单一：主要依赖 B-Tree (InnoDB)，全文索引和空间索引功能相对较弱。       |
| 可扩展性        | 插件化核心：可通过 PostGIS (地理) 或 pgvector (AI/向量) 轻松扩展功能。         | 存储引擎插件化：虽然可更换存储引擎（如 InnoDB, MyASAM），但核心功能扩展较难。  |
| 复杂查询优化      | 卓越：拥有更智能的查询优化器，支持 Hash Join、物化视图及复杂的 CTE 递归。              | 一般：更擅长简单、高频率的 CRUD 操作，复杂多表关联性能瓶颈较明显。            |
| AI 与现代负载    | 优势显著：凭借向量索引插件，已成为 2026 年 AI 应用存储 Embeddings 的首选。          | 演进中：正在通过 8.x 及更高版本增强 JSON 和向量处理能力，但生态稍显滞后。      |
| 数据完整性       | 严苛：强约束校验（Check, Foreign Key），确保数据在底层绝对合法。                 | 灵活：在某些配置下允许非严格数据插入，更侧重于业务吞吐量。                   |

### PgSQL与MySQL在表/索引/约束/外键方面的不同

| 特性     | PostgreSQL                                   | MySQL                          |
|--------|----------------------------------------------|--------------------------------|
| **表**  | 单一存储引擎，支持丰富的数据类型、分区、扩展类型                     | 多存储引擎（如 InnoDB、MyISAM），支持表分区   |
| **索引** | 支持多种索引类型（B-tree、GIN、GiST、BRIN等），支持表达式索引和部分索引 | 支持常见的B-tree索引和全文索引，InnoDB为聚簇索引 |
| **约束** | 支持外键、检查约束、排它性约束、部分约束                         | 支持外键（仅InnoDB）、检查约束、唯一约束等       |
| **外键** | 强大外键支持，支持级联、延迟检查、复杂约束                        | 仅InnoDB支持外键，功能较为简单，支持级联删除、更新   |

### 扩展功能

PostgreSQL 是一个高度可扩展的数据库管理系统，它通过多种扩展机制，使得开发者可以根据具体需求增加或自定义功能。PostgreSQL
的扩展功能是其最强大的特点之一，可以显著增强数据库的功能和性能。以下是 PostgreSQL 扩展功能的详细介绍：

#### 1. 自定义数据类型

PostgreSQL 允许开发者定义自定义数据类型，这使得它在处理复杂数据模型时非常灵活。可以创建新的类型来表示特定的业务需求或数据结构。

* **复合类型**：通过组合多个基础数据类型，可以创建复合数据类型（例如，表示一个“地址”的复合类型，包括“街道”、“城市”、“邮政编码”等字段）。
* **枚举类型（ENUM）**：允许定义一组有限的值（例如，一个“状态”字段，值可能为“待处理”、“已完成”、“已取消”）。
* **范围类型（Range）**：允许定义范围数据类型，例如时间范围（`daterange`）、数字范围（`int4range`）、时间戳范围等。
* **用户定义的类型**：开发者可以通过扩展 SQL 或者使用 C 语言创建完全自定义的类型和类型操作符。

##### 示例

```sql
CREATE TYPE address AS (
    street VARCHAR,
    city VARCHAR,
    postal_code VARCHAR
    );
```

#### 2. 自定义函数与操作符

PostgreSQL 支持用户定义的函数和操作符，允许开发者根据需要创建新的操作符或函数，并支持多种编程语言（如
PL/pgSQL、PL/Python、PL/Perl、C 等）。

* **内建支持的语言**：PostgreSQL 支持多种函数语言（如 PL/pgSQL、PL/Python、PL/Perl、PL/Java 等）。
* **自定义操作符**：可以为自定义数据类型或内建类型定义新的操作符，例如，开发者可以为自定义的`address`
  类型定义一个“+”操作符，用于将两个地址合并。

##### 示例创建一个简单的加法操作符

```sql
CREATE
OPERATOR + (
    LEFTARG = address,
    RIGHTARG = address,
    PROCEDURE = address_add
);
```

#### 3. 扩展

PostgreSQL 提供了丰富的扩展机制，可以通过扩展安装新的功能、特性或优化。扩展可以被视为“插件”，其功能可以从数据库的核心功能中分离出来，从而实现更灵活的功能增强。

一些常用的 PostgreSQL 扩展包括：

* **PostGIS**：用于地理空间数据处理，支持空间数据类型和空间查询。
* **pg_partman**：提供自动化的表分区功能，简化分区表管理。
* **pg_stat_statements**：用于跟踪和记录查询的执行计划及性能统计信息。
* **hstore**：提供键值对存储功能，适用于处理半结构化数据。
* **citext**：提供不区分大小写的文本类型，适用于需要不区分大小写比较的场景。
* **pgcrypto**：提供加密和解密功能，支持对称和非对称加密算法。

##### 安装扩展

扩展可以通过 `CREATE EXTENSION` 命令进行安装：

```sql
CREATE
EXTENSION IF NOT EXISTS postgis;
```

#### 4. 全文搜索扩展

PostgreSQL 提供强大的全文搜索功能，允许在文本数据中执行复杂的搜索。它支持通过特定的文本索引（如 `GIN`
索引）来加速搜索操作，并且可以对文档进行词频分析、去除停用词等操作。

* **tsvector**：用于表示文档的词汇表示。
* **tsquery**：用于表示搜索查询。
* **GIN 索引**：可以提高全文搜索的效率。

##### 示例

```sql
-- 创建一个 tsvector 类型的列
ALTER TABLE articles
    ADD COLUMN content_tsvector tsvector;
UPDATE articles
SET content_tsvector = to_tsvector('english', content);

-- 创建 GIN 索引来加速全文搜索
CREATE INDEX idx_content_tsvector ON articles USING gin(content_tsvector);

-- 执行全文搜索查询
SELECT *
FROM articles
WHERE content_tsvector @@ to_tsquery('english', 'database & postgresql');
```

### 成功案例

#### 1. Supabase：以 PostgreSQL 为核心，重构开发者体验

Supabase 并非简单的“开源 Firebase”。它的核心战略是以 PostgreSQL 为核心，围绕其构建一个完整的、开放的全栈开发平台。

**战略路径**：它敏锐地抓住了开发者在 NoSQL 浪潮后对 SQL 强大能力与灵活性的“回归”需求，以及他们对封闭云服务的顾虑。Supabase
提供了实时订阅、自动生成 API、内置认证与存储等服务，但所有这些功能都紧密耦合并原生作用于同一个 PostgreSQL
数据库。开发者获得的不是一个黑盒服务，而是一个拥有完全数据主权、可本地开发、也可一键部署的完整开源栈。

**增长验证**：这一模式击中了市场痛点。其估值在短期内迅速达到 20 亿美元，近期更是达到 50 亿美元的新高，这不仅是资本对其产品市场的认可，更是对
“开源 PostgreSQL 作为现代应用开发核心” 这一范式的高度定价。Supabase 证明，将顶尖的开发者体验与一个无限强大的开源数据库深度结合，可以创造出巨大的商业价值。

#### 2. Neon：解构与重塑，让 PostgreSQL 生于云原生时代

Neon 则代表了另一条更具颠覆性的路径：它没有仅仅在 PostgreSQL 之上构建应用层，而是深入内核，对其架构进行面向云原生与 AI
时代的手术式改造。

**核心创新**：Neon 实现了存储与计算的彻底分离，将 PostgreSQL
转变为真正的无服务器（Serverless）数据库。这意味着计算实例可以瞬间冷启动、按需扩展至零，并实现分支等现代开发流程。

**契合 AI 场景**：这一创新完美匹配了 AI 智能体（Agent）的工作模式——其数据库访问模式常是突发、短暂且不可预测的。超过 80%的
Neon 数据库由 AI 代理自动创建和销毁，这使其成为 AI 原生应用的“瞬时记忆体”。这种前瞻性的产品定义，使其被数据与 AI 巨头
Databricks
以约 10 亿美元收购，标志着市场对 “无服务器 PostgreSQL 是 AI 时代关键基础设施” 这一判断的背书。

#### 3. Citus Data （被微软收购）

专注于将 PostgreSQL 横向扩展为分布式数据库，解决了大规模、高并发场景下的核心瓶颈，其能力现已集成到 Azure Cosmos DB 与 Azure
Database for PostgreSQL 中。

#### 3. TimescaleDB

作为专注于时序数据的 PostgreSQL 扩展，它成功在监控、物联网等场景开拓市场，并发展为一家成熟的商业公司，证明了在 PostgreSQL
专精赛道的巨大潜力。